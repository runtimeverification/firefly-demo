pipeline {
  agent none
  options {
    ansiColor('xterm')
  }
  stages {
    stage("Init title") {
      when { changeRequest() }
      steps {
        script {
          currentBuild.displayName = "PR ${env.CHANGE_ID}: ${env.CHANGE_TITLE}"
        }
      }
    }
    stage('Run Firefly Demo') {
      agent { dockerfile { dir "jenkins" } }
      when { changeRequest() }
      options { timeout(time: 60, unit: 'MINUTES') }
      steps {
        sh '''
          ./firefly-demo.sh
        '''
      }
    }
  }
}
